# README

* Some of Git's terminology and design choices are confusing at first but once
  you learn how Git works, it makes more sense.

* **Commits never change** - once you have made a commit, it is set forever
    * the _files in it_ never change
    * its _diff_ never changes
    * its _history_ never changes
    * the _message and author_ never change

* The reason commits never change is that their _ID_ is generated from their
  _contents_.
    * Every file, parent/s, message, author, and timestamp is used to generate
      a SHA-1 hash

* You can imagine that commits are a trail of diffs; combining all diffs
  together will result with the current state of the project. This is not how
  Git works but is a useful way of thinking about commits.

* You can also think of commits as a _pile of snapshots_ and this is how Git is
  implemented.

* _diffs_ are calculated from _snapshots_ - the _diff_ for a commit is the
  difference between it and its _parent_.

* Some things you can do with a commit:
    * Get the files in the commit (`git checkout`)
    * Calculate the diff from its parent (`git show`)
    * Merge it with another commit (`git merge`)
    * Examine its parents, grandparents, etc. (`git log`)

You can see how Git stores your files by using `git cat-file -p commit_hash`. 

```console
git cat-file -p $(git log | head -1 | cut -f2 -d' ')
```
```
tree d45baedabf242e3778d109c343aa3992180e10d9
parent f0f3e67f78fbe45547f097b000f68853168ca5f0
author Dave Tang <davetingpongtang@gmail.com> 1709510735 +0900
committer Dave Tang <davetingpongtang@gmail.com> 1709510735 +0900

Update remote URL
```

The hash in `tree d45baedabf242e3778d109c343aa3992180e10d9` is the directory
ID. Use the directory ID to read the directory.

```console
git cat-file -p d45baedabf242e3778d109c343aa3992180e10d9
```
```
040000 tree d5306cbca42870de6b6a360ffcd3db5bf88a244f	.github
100644 blob 783cd5baaf2fd95f3b3c8fe827d52453d36e410d	.gitignore
100644 blob 0e259d42c996742e9e3cba14c677129b2c1b6311	LICENSE
100644 blob 86b2926b3121634b7157f1158551cfff91dd6e0b	README.md
040000 tree c472474bf28be1165285800c4638b2401a2d132d	gitlab
040000 tree 8374f62914849d013893fe59eb719b8a4913087a	img
100755 blob 36b78478b72180abbd731fd6e423a90323f0f0cc	now.sh
100755 blob f8653d2271f69710d0e9232b052de9a2756f827f	rename_master_to_main.sh
040000 tree 719a1ad9dd7ebc466777336b54acab45f89206cf	rmarkdown
```

The hash in `100755 blob 36b78478b72180abbd731fd6e423a90323f0f0cc	now.sh` is
the file ID. This SHA-1 hash is generated by the contents of `now.sh`. (You
can't simply generate this hash on the file by using `sha1sum` because the
[hash is generated using other information
too](https://stackoverflow.com/questions/5290444/why-does-git-hash-object-return-a-different-hash-than-openssl-sha1).)

We can use the hash to read the file.

```console
git cat-file -p 36b78478b72180abbd731fd6e423a90323f0f0cc
```
```
#!/usr/bin/env bash

set -euo pipefail

now(){
   date '+%Y/%m/%d %H:%M:%S'
}

# seconds to sleep
s=2

>&2 printf "[ %s %s ] Start\n" $(now)
>&2 echo Sleeping for ${s} seconds
sleep ${s}
>&2 printf "[ %s %s ] End\n" $(now)

exit 0
```

* Storing files by their hash makes Git efficient: if you change one file, Git
  only needs to save one new blob to store the snapshot.

* While commits are usually saved forever but Git's garbage collection
  periodically deletes _unreachable commits_.

* Some ways commits get "lost" include:
    * `git commit --amend`
    * `git rebase`
    * deleting a branch that has not been merged

* Sometimes a commit isn't in the history of any branch or tag but is in the
  reflog.

* Sometimes a commit isn't referenced anywhere and you need to search all
  commits to find it.

```mermaid
graph TD;
    A-->B;
    A-->C;
    B-->D;
    C-->D;
```
